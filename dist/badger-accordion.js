!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BadgerAccordion=e()}(this,function(){"use strict";!function(t,e){var n=(t.body||t.documentElement).style,i="",s="";""==n.WebkitAnimation&&(i="-webkit-"),""==n.MozAnimation&&(i="-moz-"),""==n.OAnimation&&(i="-o-"),""==n.WebkitTransition&&(s="-webkit-"),""==n.MozTransition&&(s="-moz-"),""==n.OTransition&&(s="-o-"),Object.prototype.onCSSAnimationEnd=function(t){var e=function e(n){t(),n.target.removeEventListener(n.type,e)};return this.addEventListener("webkitAnimationEnd",e),this.addEventListener("mozAnimationEnd",e),this.addEventListener("oAnimationEnd",e),this.addEventListener("oanimationend",e),this.addEventListener("animationend",e),(""!=i||"animation"in n)&&"0s"!=getComputedStyle(this)[i+"animation-duration"]||t(),this},Object.prototype.onCSSTransitionEnd=function(t){var e=function e(n){t(),n.target.removeEventListener(n.type,e)};return this.addEventListener("webkitTransitionEnd",e),this.addEventListener("mozTransitionEnd",e),this.addEventListener("oTransitionEnd",e),this.addEventListener("transitionend",e),this.addEventListener("transitionend",e),(""!=s||"transition"in n)&&"0s"!=getComputedStyle(this)[s+"transition-duration"]||t(),this}}(document,window);var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();return function(){function e(t,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=document.querySelector(t);if(null!=i){this.settings=Object.assign({},{headerClass:".js-badger-accordion-header",panelClass:".js-badger-accordion-panel",panelInnerClass:".js-badger-accordion-panel-inner",hidenClass:"is-hidden",initalisedClass:"badger-accordion--initalised",headerDataAttr:"data-badger-accordion-header-id",openMultiplePanels:!1,openHeadersOnLoad:[],headerOpenLabel:"Open accordion panel",headerCloseLabel:"Close accordion panel"},n),this.container=i,this.headers=Array.from(this.container.querySelectorAll(this.settings.headerClass)),this.panels=Array.from(this.container.querySelectorAll(this.settings.panelClass)),this.toggleEl=void 0!==this.settings.toggleEl?Array.from(this.container.querySelectorAll(this.settings.toggleEl)):this.headers,this.states=[].map.call(this.headers,function(){return{state:"closed"}}),this.ids=[].map.call(this.headers,function(){return{id:Math.floor(1e6*Math.random()+1)}}),this.toggling=!1,this.container?this.init():console.log("Something is wrong with you markup...")}}return t(e,[{key:"init",value:function(){this._setupAttributes(),this._initalState(),this._setPanelHeight(),this._insertDataAttrs(),this._addListeners(),this._finishInitalisation()}},{key:"_initalState",value:function(){var t=this.settings.openHeadersOnLoad;t.length&&this._openHeadersOnLoad(t),this._renderDom()}},{key:"_insertDataAttrs",value:function(){var t=this;this.headers.forEach(function(e,n){e.setAttribute(t.settings.headerDataAttr,n)})}},{key:"_finishInitalisation",value:function(){this.container.classList.add(this.settings.initalisedClass)}},{key:"_addListeners",value:function(){var t=this;this.headers.forEach(function(e,n){e.addEventListener("click",function(){t.handleClick(e,n)})})}},{key:"handleClick",value:function(t,e){var n=this.settings.headerClass.substr(1);t.classList.contains(n)&&!1===this.toggling&&(this.toggling=!0,this.setState(e),this._renderDom())}},{key:"setState",value:function(t){var e=this,n=this.getState();this.settings.openMultiplePanels||n.filter(function(e,n){n!=t&&(e.state="closed")}),n.filter(function(n,i){if(i==t){var s=e.toggleState(n.state);return n.state=s}})}},{key:"_renderDom",value:function(){var t=this;this.states.filter(function(e,n){"open"===e.state&&t.open(n)}),this.states.filter(function(e,n){"closed"===e.state&&t.close(n)})}},{key:"open",value:function(t){this.togglePanel("open",t)}},{key:"close",value:function(t){this.togglePanel("closed",t)}},{key:"openAll",value:function(){var t=this;this.headers.forEach(function(e){t.togglePanel("open",e)})}},{key:"closeAll",value:function(){var t=this;this.headers.forEach(function(e){t.togglePanel("closed",e)})}},{key:"togglePanel",value:function(t,e){var n=this;if(void 0!==t&&void 0!==e)if("closed"===t){var i=this.headers[e],s=this.panels[e];s.classList.add(this.settings.hidenClass),i.setAttribute("aria-expanded",!1),i.setAttribute("aria-label",this.settings.headerOpenLabel),s.onCSSTransitionEnd(function(){return n.toggling=!1})}else if("open"===t){var a=this.headers[e],r=this.panels[e];r.classList.remove(this.settings.hidenClass),a.setAttribute("aria-expanded",!0),a.setAttribute("aria-label",this.settings.headerCloseLabel),r.onCSSTransitionEnd(function(){return n.toggling=!1})}}},{key:"getState",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length&&Array.isArray(e)){return e.map(function(e){return t.states[e]})}return this.states}},{key:"toggleState",value:function(t){if(void 0!==t)return"closed"===t?"open":"closed"}},{key:"_openHeadersOnLoad",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length&&Array.isArray(e)){e.filter(function(t){return void 0!=t}).forEach(function(e){return t.states[e].state="open"})}}},{key:"_setPanelHeight",value:function(){var t=this;this.panels.forEach(function(e){var n=e.querySelector(t.settings.panelInnerClass).offsetHeight;return e.style.maxHeight=n+"px"})}},{key:"_setupHeaders",value:function(){var t=this;this.headers.forEach(function(e,n){e.setAttribute("id","badger-accordion-header-"+t.ids[n].id),e.setAttribute("aria-controls","badger-accordion-panel-"+t.ids[n].id),e.setAttribute("aria-label",t.settings.headerOpenLabel)})}},{key:"_setupPanels",value:function(){var t=this;this.panels.forEach(function(e,n){e.setAttribute("id","badger-accordion-panel-"+t.ids[n].id),e.setAttribute("aria-labeledby","badger-accordion-header-"+t.ids[n].id)})}},{key:"_setupAttributes",value:function(){this._setupHeaders(),this._setupPanels(),this._insertDataAttrs()}}]),e}()});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFkZ2VyLWFjY29yZGlvbi5qcyIsInNvdXJjZXMiOlsiLi4vc3JjL2pzL3RyYW5zaXRpb24tZW5kLmpzIiwiLi4vc3JjL2pzL2JhZGdlci1hY2NvcmRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcblx0QnkgT3N2YWxkYXMgVmFsdXRpcywgd3d3Lm9zdmFsZGFzLmluZm9cblx0QXZhaWxhYmxlIGZvciB1c2UgdW5kZXIgdGhlIE1JVCBMaWNlbnNlXG4qL1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbihmdW5jdGlvbihkb2N1bWVudCwgd2luZG93KSB7XG4gICAgbGV0IGVsID0gZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG4gICAgICAgIHMgPSBlbC5zdHlsZSxcbiAgICAgICAgcHJlZml4QW5pbWF0aW9uID0gJycsXG4gICAgICAgIHByZWZpeFRyYW5zaXRpb24gPSAnJztcblxuICAgIGlmIChzLldlYmtpdEFuaW1hdGlvbiA9PSAnJylcbiAgICAgICAgcHJlZml4QW5pbWF0aW9uID0gJy13ZWJraXQtJztcbiAgICBpZiAocy5Nb3pBbmltYXRpb24gPT0gJycpXG4gICAgICAgIHByZWZpeEFuaW1hdGlvbiA9ICctbW96LSc7XG4gICAgaWYgKHMuT0FuaW1hdGlvbiA9PSAnJylcbiAgICAgICAgcHJlZml4QW5pbWF0aW9uID0gJy1vLSc7XG5cbiAgICBpZiAocy5XZWJraXRUcmFuc2l0aW9uID09ICcnKVxuICAgICAgICBwcmVmaXhUcmFuc2l0aW9uID0gJy13ZWJraXQtJztcbiAgICBpZiAocy5Nb3pUcmFuc2l0aW9uID09ICcnKVxuICAgICAgICBwcmVmaXhUcmFuc2l0aW9uID0gJy1tb3otJztcbiAgICBpZiAocy5PVHJhbnNpdGlvbiA9PSAnJylcbiAgICAgICAgcHJlZml4VHJhbnNpdGlvbiA9ICctby0nO1xuXG4gICAgT2JqZWN0LnByb3RvdHlwZS5vbkNTU0FuaW1hdGlvbkVuZCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBydW5PbmNlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIGUudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZS50eXBlLCBydW5PbmNlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRBbmltYXRpb25FbmQnLCBydW5PbmNlKTtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdtb3pBbmltYXRpb25FbmQnLCBydW5PbmNlKTtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdvQW5pbWF0aW9uRW5kJywgcnVuT25jZSk7XG4gICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcignb2FuaW1hdGlvbmVuZCcsIHJ1bk9uY2UpO1xuICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ2FuaW1hdGlvbmVuZCcsIHJ1bk9uY2UpO1xuICAgICAgICBpZiAoKHByZWZpeEFuaW1hdGlvbiA9PSAnJyAmJiAhKCdhbmltYXRpb24nIGluIHMpKSB8fCBnZXRDb21wdXRlZFN0eWxlKHRoaXMpW3ByZWZpeEFuaW1hdGlvbiArICdhbmltYXRpb24tZHVyYXRpb24nXSA9PSAnMHMnKVxuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIE9iamVjdC5wcm90b3R5cGUub25DU1NUcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHJ1bk9uY2UgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgZS50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLnR5cGUsIHJ1bk9uY2UpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBydW5PbmNlKTtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdtb3pUcmFuc2l0aW9uRW5kJywgcnVuT25jZSk7XG4gICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcignb1RyYW5zaXRpb25FbmQnLCBydW5PbmNlKTtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgcnVuT25jZSk7XG4gICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIHJ1bk9uY2UpO1xuICAgICAgICBpZiAoKHByZWZpeFRyYW5zaXRpb24gPT0gJycgJiYgISgndHJhbnNpdGlvbicgaW4gcykpIHx8IGdldENvbXB1dGVkU3R5bGUodGhpcylbcHJlZml4VHJhbnNpdGlvbiArICd0cmFuc2l0aW9uLWR1cmF0aW9uJ10gPT0gJzBzJylcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG59KGRvY3VtZW50LCB3aW5kb3csIDApKTtcblxuLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cbmV4cG9ydCBkZWZhdWx0IG1vZHVsZTtcbiIsIi8qKlxuICogIEFDQ09SRElPTlxuICpcbiAqIEEgbGlnaHR3aWdodCB2YW5pbGxhIEpTIGFjY29yZGlvbiB3aXRoIGFuIGV4c3RlbnNpYmxlIEFQSVxuICovXG5cbi8vIGltcG9ydCB1dWlkIGZyb20gJ3V1aWQvdjQnO1xuLy8gY29uc3QgdXVpZFY0ID0gdXVpZDtcbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG5pbXBvcnQgb25DU1NUcmFuc2l0aW9uRW5kIGZyb20gJ3RyYW5zaXRpb24tZW5kJztcblxuLyoqXG4gKiBDT05TVFJVQ1RPUlxuICogaW5pdGlhbGlzZXMgdGhlIG9iamVjdFxuICovXG5jbGFzcyBCYWRnZXJBY2NvcmRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xuXG4gICAgICAgIC8vIElmIGVsIGlzIG5vdCBkZWZpbmVkXG4gICAgICAgIGlmIChjb250YWluZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgICAgICAgICBoZWFkZXJDbGFzczogICAgICAgICcuanMtYmFkZ2VyLWFjY29yZGlvbi1oZWFkZXInLFxuICAgICAgICAgICAgcGFuZWxDbGFzczogICAgICAgICAnLmpzLWJhZGdlci1hY2NvcmRpb24tcGFuZWwnLFxuICAgICAgICAgICAgcGFuZWxJbm5lckNsYXNzOiAgICAnLmpzLWJhZGdlci1hY2NvcmRpb24tcGFuZWwtaW5uZXInLFxuICAgICAgICAgICAgaGlkZW5DbGFzczogICAgICAgICAnaXMtaGlkZGVuJyxcbiAgICAgICAgICAgIGluaXRhbGlzZWRDbGFzczogICAgJ2JhZGdlci1hY2NvcmRpb24tLWluaXRhbGlzZWQnLFxuICAgICAgICAgICAgaGVhZGVyRGF0YUF0dHI6ICAgICAnZGF0YS1iYWRnZXItYWNjb3JkaW9uLWhlYWRlci1pZCcsXG4gICAgICAgICAgICBvcGVuTXVsdGlwbGVQYW5lbHM6IGZhbHNlLFxuICAgICAgICAgICAgb3BlbkhlYWRlcnNPbkxvYWQ6ICBbXSxcbiAgICAgICAgICAgIGhlYWRlck9wZW5MYWJlbDogICAgJ09wZW4gYWNjb3JkaW9uIHBhbmVsJyxcbiAgICAgICAgICAgIGhlYWRlckNsb3NlTGFiZWw6ICAgJ0Nsb3NlIGFjY29yZGlvbiBwYW5lbCdcbiAgICAgICAgICAgIC8vIHRvZ2dsZUVsOiAgICAgICAgICAgIC8vIElmIHlvdSB3YW50IHRvIHVzZSBhIGRpZmZlcmVudCBlbGVtZW50IHRvIHRyaWdnZXIgdGhlIGFjY29yZGlvblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIE9wdGlvbnNcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgICAgICAvLyBTZXR0aW5nIGdldHRpbmcgZWxlbWVudHNcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMuaGVhZGVycyA9IEFycmF5LmZyb20oIHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5zZXR0aW5ncy5oZWFkZXJDbGFzcykgKTtcbiAgICAgICAgdGhpcy5wYW5lbHMgPSBBcnJheS5mcm9tKCB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuc2V0dGluZ3MucGFuZWxDbGFzcykgKTtcbiAgICAgICAgdGhpcy50b2dnbGVFbCA9IHRoaXMuc2V0dGluZ3MudG9nZ2xlRWwgIT09IHVuZGVmaW5lZCA/IEFycmF5LmZyb20odGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNldHRpbmdzLnRvZ2dsZUVsKSkgOiB0aGlzLmhlYWRlcnM7XG5cbiAgICAgICAgLy8gVGhpcyBpcyBmb3IgbWFuYWdpbmcgc3RhdGUgb2YgdGhlIGFjY29yZGlvbi4gSXQgYnkgZGVmYXVsdCBzZXRzXG4gICAgICAgIC8vIGFsbCBhY2NvcmRpb24gcGFuZWxzIHRvIGJlIGNsb3NlZFxuICAgICAgICB0aGlzLnN0YXRlcyA9IFtdLm1hcC5jYWxsKHRoaXMuaGVhZGVycywgKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3RhdGU6ICdjbG9zZWQnIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuaWRzID0gW10ubWFwLmNhbGwodGhpcy5oZWFkZXJzLCAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4geyBpZDogTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApICsgMSkgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVGhpcyBpcyB0byBlbnN1cmUgdGhhdCBvbmNlIGFuIG9wbmUvY2xvc2UgZXZlbnQgaGFzIGJlZW4gZmlyZWRcbiAgICAgICAgLy8gYW5vdGhlciBjYW5ub3Qgc3RhcnQgdW50aWwgdGhlIGZpcnN0IGV2ZW50IGhhcyBmaW5pc2hlZC5cbiAgICAgICAgLy8gQFRPRE8gLSBnZXQgdGhpcyB3b3JraW5nLi4uXG4gICAgICAgIHRoaXMudG9nZ2xpbmcgPSBmYWxzZTtcblxuICAgICAgICAvLyBJbml0aWF0aW5nIHRoZSBhY2NvcmRpb25cbiAgICAgICAgaWYoIHRoaXMuY29udGFpbmVyICkge1xuICAgICAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU29tZXRoaW5nIGlzIHdyb25nIHdpdGggeW91IG1hcmt1cC4uLicpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiAgSU5JVFxuICAgICAqXG4gICAgICogIEluaXRhbGlzZXMgdGhlIGFjY29yZGlvblxuICAgICAqL1xuICAgIGluaXQoKSB7XG4gICAgICAgIC8vIFNldHMgdXAgSUQsIGFyaWEgYXR0cnMgJiBkYXRhLWF0dHJzXG4gICAgICAgIHRoaXMuX3NldHVwQXR0cmlidXRlcygpO1xuXG4gICAgICAgIC8vIFNldHRpbmcgdXAgdGhlIGluaXRhbCB2aWV3IG9mIHRoZSBhY2NvcmRpb25cbiAgICAgICAgdGhpcy5faW5pdGFsU3RhdGUoKTtcblxuICAgICAgICAvLyBTZXR0aW5nIHRoZSBoZWlnaHQgb2YgZWFjaCBwYW5lbFxuICAgICAgICB0aGlzLl9zZXRQYW5lbEhlaWdodCgpO1xuXG4gICAgICAgIC8vIEluc2VydGluZyBkYXRhLWF0dHJpYnV0ZSBvbnRvIGVhY2ggYGhlYWRlcmBcbiAgICAgICAgdGhpcy5faW5zZXJ0RGF0YUF0dHJzKCk7XG5cbiAgICAgICAgLy8gQWRkaW5nIGxpc3RlbmVycyB0byBoZWFkZXJzXG4gICAgICAgIHRoaXMuX2FkZExpc3RlbmVycygpO1xuXG4gICAgICAgIC8vXG4gICAgICAgIHRoaXMuX2ZpbmlzaEluaXRhbGlzYXRpb24oKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqICBJTlNFUlQgREFUQSBBVFRSU1xuICAgICAqXG4gICAgICogIFVwZGF0ZXMgc3RhdGUgb2JqZWN0IGZvciBpbml0YWwgbG9hZGluZyBvZiB0aGUgYWNjb3JkaW9uXG4gICAgICovXG4gICAgX2luaXRhbFN0YXRlKCkge1xuICAgICAgICAvLyBTZXRzIHN0YXRlIG9iamVjdCBhcyBwZXIgYHRoaXMuc2V0dGluZ3Mub3BlbkhlYWRlcnNPbkxvYWRgXG4gICAgICAgIGNvbnN0IGhlYWRlcnNUb09wZW4gPSB0aGlzLnNldHRpbmdzLm9wZW5IZWFkZXJzT25Mb2FkO1xuXG4gICAgICAgIGlmIChoZWFkZXJzVG9PcGVuLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5fb3BlbkhlYWRlcnNPbkxvYWQoaGVhZGVyc1RvT3Blbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZW5kZXIgRE9NIGFzIHBlciB0aGUgdXBkYXRlcyBgdGhpcy5zdGF0ZXNgIG9iamVjdFxuICAgICAgICB0aGlzLl9yZW5kZXJEb20oKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqICBJTlNFUlQgREFUQSBBVFRSU1xuICAgICAqXG4gICAgICogIEFkZHMgYGhlYWRlckRhdGFBdHRyYCB0byBhbGwgaGVhZGVyc1xuICAgICAqL1xuICAgIF9pbnNlcnREYXRhQXR0cnMoKSB7XG4gICAgICAgIHRoaXMuaGVhZGVycy5mb3JFYWNoKCAoaGVhZGVyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaGVhZGVyLnNldEF0dHJpYnV0ZSh0aGlzLnNldHRpbmdzLmhlYWRlckRhdGFBdHRyLCBpbmRleCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogIEZJTklTSCBJTklUQUxJU0FUSU9OXG4gICAgICpcbiAgICAgKiAgQWRkcyBpbiBgaW5pdGFsaXNlZENsYXNzYCB0byBhY2NvcmRpb25cbiAgICAgKi9cbiAgICBfZmluaXNoSW5pdGFsaXNhdGlvbigpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCh0aGlzLnNldHRpbmdzLmluaXRhbGlzZWRDbGFzcyk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiAgQUREIExJU1RFTkVSU1xuICAgICAqXG4gICAgICogIEFkZHMgY2xpY2sgZXZlbnQgdG8gZWFjaCBoZWFkZXJcbiAgICAgKi9cbiAgICBfYWRkTGlzdGVuZXJzKCkge1xuICAgICAgICAvLyBTbyB3ZSBjYW4gcmVmZXJlbmNlIHRoZSBiYWRnZXItYWNjb3JkaW9uIG9iamVjdCBpbnNpZGUgb3V0IGV2ZW50TGlzdGVuZXJcbiAgICAgICAgY29uc3QgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIC8vIEFkZGluZyBjbGljayBldmVudCB0byBhY2NvcmRpb25cbiAgICAgICAgdGhpcy5oZWFkZXJzLmZvckVhY2goKGhlYWRlciwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIEdldHRpbmcgdGhlIHRhcmdldCBvZiB0aGUgY2xpY2tcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBjbGlja2VkRWwgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVDbGljayhoZWFkZXIsIGluZGV4KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqICBIQU5ETEUgQ0xJQ0tcbiAgICAgKlxuICAgICAqICAvL1RPRE8gLSBBZGQgY29tbWVudFxuICAgICAqICBAcGFyYW0ge29iamVjdH0gdGFyZ2V0SGVhZGVyIC0gVGhlIGhlYWRlciBub2RlIHlvdSB3YW50IHRvIG9wZW5cbiAgICAgKi9cbiAgICBoYW5kbGVDbGljayh0YXJnZXRIZWFkZXIsIGhlYWRlckluZGV4KSB7XG4gICAgICAgIC8vIFJlbW92aW5nIGN1cnJlbnQgYC5gIGZyb20gYHRoaXMuc2V0dGluZ3MuaGVhZGVyQ2xhc3NgIGNsYXNzIHNvIGl0IGNhblxuICAgICAgICAvLyBiZSBjaGVja2VkIGFnYWluc3QgdGhlIGB0YXJnZXRIZWFkZXJgIGNsYXNzTGlzdFxuICAgICAgICBjb25zdCB0YXJnZXRIZWFkZXJDbGFzcyA9IHRoaXMuc2V0dGluZ3MuaGVhZGVyQ2xhc3Muc3Vic3RyKDEpO1xuXG4gICAgICAgIC8vIENoZWNraW5nIHRoYXQgdGhlIHRoaW5nIHRoYXQgd2FzIGNsaWNrZWQgb24gd2FzIHRoZSBhY2NvcmRpb25zIGhlYWRlclxuICAgICAgICBpZiAodGFyZ2V0SGVhZGVyLmNsYXNzTGlzdC5jb250YWlucyh0YXJnZXRIZWFkZXJDbGFzcykgJiYgdGhpcy50b2dnbGluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGluZyBzdGF0ZXNcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoaGVhZGVySW5kZXgpO1xuXG5cbiAgICAgICAgICAgIC8vIFJlbmRlciBET00gYXMgcGVyIHRoZSB1cGRhdGVzIGB0aGlzLnN0YXRlc2Agb2JqZWN0XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJEb20oKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogIFNFVCBTVEFURVNcbiAgICAgKlxuICAgICAqICBTZXRzIHRoZSBzdGF0ZSBmb3IgYWxsIGhlYWRlcnMuIFRoZSAndGFyZ2V0IGhlYWRlcicgd2lsbCBoYXZlIGl0cyBzdGF0ZSB0b2dnZWxlZFxuICAgICAqICBAcGFyYW0ge29iamVjdH0gdGFyZ2V0SGVhZGVySWQgLSBUaGUgaGVhZGVyIG5vZGUgeW91IHdhbnQgdG8gb3BlblxuICAgICAqL1xuICAgIHNldFN0YXRlKHRhcmdldEhlYWRlcklkKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IHRoaXMuZ2V0U3RhdGUoKTtcblxuICAgICAgICAvLyBUT0RPIC0gaW1wcm92ZSB0aGlzIGNvbW1lbnRcbiAgICAgICAgLy8gSWYgYHRoaXMuc2V0dGluZ3Mub3Blbk11bHRpcGxlUGFuZWxzYCBpcyBmYWxzZSB3ZSBuZWVkIHRvIGVuc3VyZSBvbmx5IG9uZSBwYW5lbFxuICAgICAgICAvLyBiZSBjYW4gb3BlbiBhdCBvbmNlLiBUaGlzIHdpbGwgdGhlIHN0YXRlIG9uIGFsbCBidXQgdGhlIHRhcmdldCBoZWFkZXIgdG8gJ2Nsb3NlZCdcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLm9wZW5NdWx0aXBsZVBhbmVscykge1xuICAgICAgICAgICAgc3RhdGVzLmZpbHRlcigoc3RhdGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9IHRhcmdldEhlYWRlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLnN0YXRlID0gJ2Nsb3NlZCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb2dnbGVzIHRoZSBzdGF0ZSB2YWx1ZSBvZiB0aGUgdGFyZ2V0IGhlYWRlci4gVGhpcyB3YXMgYGFycmF5LmZpbmRgIGJ1dCBgZmluZGBcbiAgICAgICAgLy8gaXNudCBzdXBwb3J0ZWQgaW4gSUUxMVxuICAgICAgICBzdGF0ZXMuZmlsdGVyKChzdGF0ZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PSB0YXJnZXRIZWFkZXJJZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N0YXRlID0gdGhpcy50b2dnbGVTdGF0ZShzdGF0ZS5zdGF0ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChzdGF0ZS5zdGF0ZSA9IG5ld1N0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiAgUkVOREVSIERPTVxuICAgICAqXG4gICAgICogIFJlbmRlcnMgdGhlIGFjY29yZGlvbiBpbiB0aGUgRE9NIHVzaW5nIHRoZSBgdGhpcy5zdGF0ZXNgIG9iamVjdFxuICAgICAqL1xuICAgIF9yZW5kZXJEb20oKSB7XG4gICAgICAgIC8vIGNvbnN0IHN0YXRlcyA9IHRoaXMuZ2V0U3RhdGUoKTtcblxuICAgICAgICAvLyBGaWx0ZXIgdGhyb3VnaCBhbGwgb3BlbiBoZWFkZXJzIGFuZCBvcGVuIHRoZW1cbiAgICAgICAgdGhpcy5zdGF0ZXMuZmlsdGVyKCAoc3RhdGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZihzdGF0ZS5zdGF0ZSA9PT0gJ29wZW4nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuKGluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRmlsdGVyIHRocm91Z2ggYWxsIGNsb3NlZCBoZWFkZXJzIGFuZCBjbG9zZXMgdGhlbVxuICAgICAgICB0aGlzLnN0YXRlcy5maWx0ZXIoIChzdGF0ZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmKHN0YXRlLnN0YXRlID09PSAnY2xvc2VkJykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoaW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqICBPUEVOXG4gICAgICpcbiAgICAgKiAgQ2xvc2VzIGEgc3BlY2lmaWMgcGFuZWxcbiAgICAgKiAgQHBhcmFtIHtvYmplY3R9IGhlYWRlciAtIFRoZSBoZWFkZXIgbm9kZSB5b3Ugd2FudCB0byBvcGVuXG4gICAgICovXG4gICAgb3BlbihoZWFkZXJJbmRleCkge1xuICAgICAgICB0aGlzLnRvZ2dsZVBhbmVsKCdvcGVuJywgaGVhZGVySW5kZXgpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogIENMT1NFXG4gICAgICpcbiAgICAgKiAgQ2xvc2VzIGEgc3BlY2lmaWMgcGFuZWxcbiAgICAgKiAgQHBhcmFtIHtvYmplY3R9IGhlYWRlciAtIFRoZSBoZWFkZXIgbm9kZSB5b3Ugd2FudCB0byBjbG9zZVxuICAgICAqL1xuICAgIGNsb3NlKGhlYWRlckluZGV4KSB7XG4gICAgICAgIHRoaXMudG9nZ2xlUGFuZWwoJ2Nsb3NlZCcsIGhlYWRlckluZGV4KTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqICBPUEVOIEFMTFxuICAgICAqXG4gICAgICogIE9wZW5zIGFsbCBwYW5lbHNcbiAgICAgKi9cbiAgICBvcGVuQWxsKCkge1xuICAgICAgICB0aGlzLmhlYWRlcnMuZm9yRWFjaCggaGVhZGVyID0+IHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlUGFuZWwoJ29wZW4nLCBoZWFkZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqICBDTE9TRSBBTExcbiAgICAgKlxuICAgICAqICBDbG9zZXMgYWxsIHBhbmVsc1xuICAgICAqL1xuICAgIGNsb3NlQWxsKCkge1xuICAgICAgICB0aGlzLmhlYWRlcnMuZm9yRWFjaCggaGVhZGVyID0+IHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlUGFuZWwoJ2Nsb3NlZCcsIGhlYWRlcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogIEdFVCBTVEFURVxuICAgICAqXG4gICAgICogIEdldHRpbmcgc3RhdGUgb2YgaGVhZGVycy4gQnkgZGVmYXVsdCBnZXRzIHN0YXRlIG9mIGFsbCBoZWFkZXJzXG4gICAgICogIEBwYXJhbSB7c3RyaW5nfSBhbmltYXRpb25BY3Rpb24gLSBUaGUgYW5pbWF0aW9uIHlvdSB3YW50IHRvIGludm9rZVxuICAgICAqICBAcGFyYW0ge29iamVjdH0gaGVhZGVyICAgICAgICAgIC0gVGhlIGhlYWRlciBub2RlIHlvdSB3YW50IHRvIGFuaW1hdGVcbiAgICAgKi9cbiAgICB0b2dnbGVQYW5lbChhbmltYXRpb25BY3Rpb24sIGhlYWRlckluZGV4KSB7XG4gICAgICAgIGlmKGFuaW1hdGlvbkFjdGlvbiAhPT0gdW5kZWZpbmVkICYmIGhlYWRlckluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKGFuaW1hdGlvbkFjdGlvbiA9PT0gJ2Nsb3NlZCcpIHtcbiAgICAgICAgICAgICAgICAvLyAxLiBHZXR0aW5nIElEIG9mIHBhbmVsIHRoYXQgd2Ugd2FudCB0byBjbG9zZVxuICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlciAgICAgICAgPSB0aGlzLmhlYWRlcnNbaGVhZGVySW5kZXhdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhbmVsVG9DbG9zZSAgPSB0aGlzLnBhbmVsc1toZWFkZXJJbmRleF07XG5cbiAgICAgICAgICAgICAgICAvLyAyLiBDbG9zZWluZyBwYW5lbFxuICAgICAgICAgICAgICAgIHBhbmVsVG9DbG9zZS5jbGFzc0xpc3QuYWRkKHRoaXMuc2V0dGluZ3MuaGlkZW5DbGFzcyk7XG5cbiAgICAgICAgICAgICAgICAvLyAzLiBTZXQgYXJpYSBhdHRyc1xuICAgICAgICAgICAgICAgIGhlYWRlci5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgaGVhZGVyLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHRoaXMuc2V0dGluZ3MuaGVhZGVyT3BlbkxhYmVsKTtcblxuICAgICAgICAgICAgICAgIC8vIDQuIFJlc2V0dGluZyB0b2dnbGluZyBzbyBhIG5ldyBldmVudCBjYW4gYmUgZmlyZWRcbiAgICAgICAgICAgICAgICBwYW5lbFRvQ2xvc2Uub25DU1NUcmFuc2l0aW9uRW5kKCgpID0+IHRoaXMudG9nZ2xpbmcgPSBmYWxzZSApO1xuICAgICAgICAgICAgfSBlbHNlIGlmKGFuaW1hdGlvbkFjdGlvbiA9PT0gJ29wZW4nKSB7XG4gICAgICAgICAgICAgICAgLy8gMS4gR2V0dGluZyBJRCBvZiBwYW5lbCB0aGF0IHdlIHdhbnQgdG8gb3BlblxuICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlciAgICAgID0gdGhpcy5oZWFkZXJzW2hlYWRlckluZGV4XTtcbiAgICAgICAgICAgICAgICBjb25zdCBwYW5lbFRvT3BlbiA9IHRoaXMucGFuZWxzW2hlYWRlckluZGV4XTtcblxuICAgICAgICAgICAgICAgIC8vIDIuIENsb3NlaW5nIHBhbmVsXG4gICAgICAgICAgICAgICAgcGFuZWxUb09wZW4uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLnNldHRpbmdzLmhpZGVuQ2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgLy8gMy4gU2V0IGFyaWEgYXR0cnNcbiAgICAgICAgICAgICAgICBoZWFkZXIuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaGVhZGVyLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHRoaXMuc2V0dGluZ3MuaGVhZGVyQ2xvc2VMYWJlbCk7XG5cbiAgICAgICAgICAgICAgICAvLyA0LiBSZXNldHRpbmcgdG9nZ2xpbmcgc28gYSBuZXcgZXZlbnQgY2FuIGJlIGZpcmVkXG4gICAgICAgICAgICAgICAgcGFuZWxUb09wZW4ub25DU1NUcmFuc2l0aW9uRW5kKCgpID0+IHRoaXMudG9nZ2xpbmcgPSBmYWxzZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvLyBAVE9ETyAtIGlzIHRoaXMgbmVlZGVkIGFueW1vcmU/XG4gICAgLy8gY2hlY2tTdGF0ZShoZWFkZXJJZCkge1xuICAgIC8vICAgICBsZXQgc3RhdGUgPSB0aGlzLnN0YXRlc1toZWFkZXJJZF0uc3RhdGU7XG4gICAgLy9cbiAgICAvLyAgICAgaWYoc3RhdGUgPT09ICdjbG9zZWQnKSB7XG4gICAgLy8gICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgLy8gICAgIH0gZWxzZSBpZihzdGF0ZSA9PT0gJ29wZW4nKSB7XG4gICAgLy8gICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgLy8gICAgIH1cbiAgICAvLyB9XG5cblxuICAgIC8qKlxuICAgICAqICBHRVQgU1RBVEVcbiAgICAgKlxuICAgICAqICBHZXR0aW5nIHN0YXRlIG9mIGhlYWRlcnMuIEJ5IGRlZmF1bHQgZ2V0cyBzdGF0ZSBvZiBhbGwgaGVhZGVyc1xuICAgICAqICBAcGFyYW0ge2FycmF5fSBoZWFkZXJJZHMgLSBJZC8ncyBvZiB0aGUgaGVhZGVycyB5b3Ugd2FudCB0byBjaGVja1xuICAgICAqL1xuICAgIGdldFN0YXRlKGhlYWRlcklkcyA9IFtdKSB7XG4gICAgICAgIGlmKGhlYWRlcklkcy5sZW5ndGggJiYgQXJyYXkuaXNBcnJheShoZWFkZXJJZHMpKSB7XG4gICAgICAgICAgICBsZXQgc3RhdGVzID0gaGVhZGVySWRzLm1hcCggaGVhZGVyID0+IHRoaXMuc3RhdGVzW2hlYWRlcl0gKTtcblxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlcztcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogIFRPR0dMRSBTVEFURVxuICAgICAqXG4gICAgICogIFRvZ2dsaW5nIHRoZSBzdGF0ZSB2YWx1ZVxuICAgICAqICBAcGFyYW0ge3N0cmluZ30gY3VycmVudFN0YXRlIC0gQ3VycmVudCBzdGF0ZSB2YWx1ZSBmb3IgYSBoZWFkZXJcbiAgICAgKi9cbiAgICB0b2dnbGVTdGF0ZShjdXJyZW50U3RhdGUpIHtcbiAgICAgICAgaWYoY3VycmVudFN0YXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAoY3VycmVudFN0YXRlID09PSAnY2xvc2VkJykgPyAnb3BlbicgOiAnY2xvc2VkJztcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbiAgICAvKipcbiAgICAgKiAgSEVBREVSUyBUTyBPUEVOXG4gICAgICpcbiAgICAgKiAgU2V0dGluZyB3aGljaCBoZWFkZXJzIHNob3VsZCBiZSBvcGVuIHdoZW4gYWNjb3JkaW9uIGlzIGluaXRhbGlzZWRcbiAgICAgKiAgQHBhcmFtIHthcnJheX0gaGVhZGVyc1RvT3BlbiAtIEFycmF5IG9mIElEJ3MgZm9yIHRoZSBoZWFkZXJzIHRvIGJlIG9wZW5cbiAgICAgKi9cbiAgICBfb3BlbkhlYWRlcnNPbkxvYWQoaGVhZGVyc1RvT3BlbiA9IFtdKSB7XG4gICAgICAgIGlmIChoZWFkZXJzVG9PcGVuLmxlbmd0aCAmJiBBcnJheS5pc0FycmF5KGhlYWRlcnNUb09wZW4pKSB7XG4gICAgICAgICAgICBsZXQgaGVhZGVycyA9IGhlYWRlcnNUb09wZW4uZmlsdGVyKGhlYWRlciA9PiBoZWFkZXIgIT0gdW5kZWZpbmVkKTtcblxuICAgICAgICAgICAgaGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLnN0YXRlc1toZWFkZXJdLnN0YXRlID0gJ29wZW4nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiAgU0VUIFBBTkVMIEhFSUdIVFxuICAgICAqXG4gICAgICogIFNldHRpbmcgaGVpZ2h0IGZvciBwYW5lbHMgdXNpbmcgcGFubmVscyBpbm5lciBlbGVtZW50XG4gICAgICovXG4gICAgX3NldFBhbmVsSGVpZ2h0KCkge1xuICAgICAgICAvLyBbXS5mb3JFYWNoLih0aGlzLnBhbmVscywgKHBhbmVsKSA9PiB7XG4gICAgICAgIHRoaXMucGFuZWxzLmZvckVhY2gocGFuZWwgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGFuZWxJbm5lciA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IodGhpcy5zZXR0aW5ncy5wYW5lbElubmVyQ2xhc3MpO1xuXG4gICAgICAgICAgICBsZXQgYWN0aXZlSGVpZ2h0ID0gcGFuZWxJbm5lci5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgICAgICAgIHJldHVybiBwYW5lbC5zdHlsZS5tYXhIZWlnaHQgPSBgJHthY3RpdmVIZWlnaHR9cHhgO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIF9zZXR1cEhlYWRlcnMoKSB7XG4gICAgICAgIHRoaXMuaGVhZGVycy5mb3JFYWNoKCAoaGVhZGVyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaGVhZGVyLnNldEF0dHJpYnV0ZSgnaWQnLCBgYmFkZ2VyLWFjY29yZGlvbi1oZWFkZXItJHt0aGlzLmlkc1tpbmRleF0uaWR9YCk7XG4gICAgICAgICAgICBoZWFkZXIuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgYGJhZGdlci1hY2NvcmRpb24tcGFuZWwtJHt0aGlzLmlkc1tpbmRleF0uaWR9YCk7XG4gICAgICAgICAgICBoZWFkZXIuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgdGhpcy5zZXR0aW5ncy5oZWFkZXJPcGVuTGFiZWwpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuXG4gICAgX3NldHVwUGFuZWxzKCkge1xuICAgICAgICB0aGlzLnBhbmVscy5mb3JFYWNoKCAocGFuZWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBwYW5lbC5zZXRBdHRyaWJ1dGUoJ2lkJywgYGJhZGdlci1hY2NvcmRpb24tcGFuZWwtJHt0aGlzLmlkc1tpbmRleF0uaWR9YCk7XG4gICAgICAgICAgICBwYW5lbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWxlZGJ5JywgYGJhZGdlci1hY2NvcmRpb24taGVhZGVyLSR7dGhpcy5pZHNbaW5kZXhdLmlkfWApO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIF9zZXR1cEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIC8vIEFkZGluZyBJRCAmIGFyaWEtY29udHJvbHNcbiAgICAgICAgdGhpcy5fc2V0dXBIZWFkZXJzKCk7XG5cbiAgICAgICAgLy8gQWRkaW5nIElEICYgYXJpYS1sYWJlbGVkYnlcbiAgICAgICAgdGhpcy5fc2V0dXBQYW5lbHMoKTtcblxuICAgICAgICAvLyBJbnNlcnRpbmcgZGF0YS1hdHRyaWJ1dGUgb250byBlYWNoIGBoZWFkZXJgXG4gICAgICAgIHRoaXMuX2luc2VydERhdGFBdHRycygpO1xuICAgIH1cbn1cblxuXG4vLyBFeHBvcnRcbmV4cG9ydCBkZWZhdWx0IEJhZGdlckFjY29yZGlvbjtcbiJdLCJuYW1lcyI6WyJkb2N1bWVudCIsIndpbmRvdyIsInMiLCJib2R5IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJwcmVmaXhBbmltYXRpb24iLCJwcmVmaXhUcmFuc2l0aW9uIiwiV2Via2l0QW5pbWF0aW9uIiwiTW96QW5pbWF0aW9uIiwiT0FuaW1hdGlvbiIsIldlYmtpdFRyYW5zaXRpb24iLCJNb3pUcmFuc2l0aW9uIiwiT1RyYW5zaXRpb24iLCJwcm90b3R5cGUiLCJvbkNTU0FuaW1hdGlvbkVuZCIsImNhbGxiYWNrIiwicnVuT25jZSIsImUiLCJ0YXJnZXQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidHlwZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJnZXRDb21wdXRlZFN0eWxlIiwidGhpcyIsIm9uQ1NTVHJhbnNpdGlvbkVuZCIsImVsIiwib3B0aW9ucyIsImNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJzZXR0aW5ncyIsIk9iamVjdCIsImFzc2lnbiIsImhlYWRlcnMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaGVhZGVyQ2xhc3MiLCJwYW5lbHMiLCJwYW5lbENsYXNzIiwidG9nZ2xlRWwiLCJ1bmRlZmluZWQiLCJzdGF0ZXMiLCJtYXAiLCJjYWxsIiwic3RhdGUiLCJpZHMiLCJpZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvZ2dsaW5nIiwiaW5pdCIsImxvZyIsIl9zZXR1cEF0dHJpYnV0ZXMiLCJfaW5pdGFsU3RhdGUiLCJfc2V0UGFuZWxIZWlnaHQiLCJfaW5zZXJ0RGF0YUF0dHJzIiwiX2FkZExpc3RlbmVycyIsIl9maW5pc2hJbml0YWxpc2F0aW9uIiwiaGVhZGVyc1RvT3BlbiIsIm9wZW5IZWFkZXJzT25Mb2FkIiwibGVuZ3RoIiwiX29wZW5IZWFkZXJzT25Mb2FkIiwiX3JlbmRlckRvbSIsImZvckVhY2giLCJoZWFkZXIiLCJpbmRleCIsInNldEF0dHJpYnV0ZSIsIl90aGlzMiIsImhlYWRlckRhdGFBdHRyIiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5pdGFsaXNlZENsYXNzIiwiX3RoaXMiLCJoYW5kbGVDbGljayIsInRhcmdldEhlYWRlciIsImhlYWRlckluZGV4IiwidGFyZ2V0SGVhZGVyQ2xhc3MiLCJzdWJzdHIiLCJjb250YWlucyIsInNldFN0YXRlIiwidGFyZ2V0SGVhZGVySWQiLCJnZXRTdGF0ZSIsIm9wZW5NdWx0aXBsZVBhbmVscyIsImZpbHRlciIsIm5ld1N0YXRlIiwiX3RoaXMzIiwidG9nZ2xlU3RhdGUiLCJvcGVuIiwiY2xvc2UiLCJ0b2dnbGVQYW5lbCIsImFuaW1hdGlvbkFjdGlvbiIsInBhbmVsVG9DbG9zZSIsImhpZGVuQ2xhc3MiLCJoZWFkZXJPcGVuTGFiZWwiLCJfdGhpczciLCJwYW5lbFRvT3BlbiIsInJlbW92ZSIsImhlYWRlckNsb3NlTGFiZWwiLCJoZWFkZXJJZHMiLCJpc0FycmF5IiwiX3RoaXM4IiwiY3VycmVudFN0YXRlIiwiX3RoaXM5IiwiYWN0aXZlSGVpZ2h0IiwicGFuZWwiLCJfdGhpczEwIiwicGFuZWxJbm5lckNsYXNzIiwib2Zmc2V0SGVpZ2h0IiwibWF4SGVpZ2h0IiwiX3RoaXMxMSIsIl90aGlzMTIiLCJfc2V0dXBIZWFkZXJzIiwiX3NldHVwUGFuZWxzIl0sIm1hcHBpbmdzIjoiNExBS0MsU0FBU0EsRUFBVUMsT0FFWkMsR0FES0YsRUFBU0csTUFBUUgsRUFBU0ksaUJBQ3hCQyxNQUNQQyxFQUFrQixHQUNsQkMsRUFBbUIsR0FFRSxJQUFyQkwsRUFBRU0sa0JBQ0ZGLEVBQWtCLFlBQ0EsSUFBbEJKLEVBQUVPLGVBQ0ZILEVBQWtCLFNBQ0YsSUFBaEJKLEVBQUVRLGFBQ0ZKLEVBQWtCLE9BRUksSUFBdEJKLEVBQUVTLG1CQUNGSixFQUFtQixZQUNBLElBQW5CTCxFQUFFVSxnQkFDRkwsRUFBbUIsU0FDRixJQUFqQkwsRUFBRVcsY0FDRk4sRUFBbUIsY0FFaEJPLFVBQVVDLGtCQUFvQixTQUFTQyxPQUN0Q0MsRUFBVSxTQUFWQSxFQUFtQkMsU0FFakJDLE9BQU9DLG9CQUFvQkYsRUFB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
